---
import BaseLayout from '../layouts/BaseLayout.astro';
import cvData from '../data/cv.json';
import type { CVData } from '../types/cv';

const cv = cvData as CVData;

// Structured Data for CV page
const structuredData = {
  "@context": "https://schema.org",
  "@type": "Person",
  "name": cv.personal.name,
  "jobTitle": cv.personal.title,
  "description": cv.summary,
  "email": cv.personal.email,
  "url": "https://camarneiro.com",
  "sameAs": [
    cv.personal.linkedin,
    cv.personal.github
  ],
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Porto",
    "addressRegion": "Porto Metropolitan Area",
    "addressCountry": "PT"
  },
  "alumniOf": {
    "@type": "EducationalOrganization",
    "name": "Instituto Superior de Engenharia de Coimbra"
  },
  "knowsLanguage": [
    {
      "@type": "Language",
      "name": "Portuguese",
      "proficiencyLevel": "Native"
    },
    {
      "@type": "Language",
      "name": "English",
      "proficiencyLevel": "Fluent"
    }
  ],
  "hasOccupation": cv.experience.slice(0, 3).map(exp => ({
    "@type": "OrganizationRole",
    "roleName": exp.title,
    "startDate": exp.startDate,
    "endDate": exp.endDate || new Date().toISOString().split('T')[0],
    "worksFor": {
      "@type": "Organization",
      "name": exp.company,
      "address": {
        "@type": "PostalAddress",
        "addressLocality": exp.location
      }
    }
  }))
};

// Helper function to format dates
function formatDate(dateString: string | null): string {
  if (!dateString) return 'Present';
  const [year, month] = dateString.split('-');
  const date = new Date(parseInt(year), month ? parseInt(month) - 1 : 0);
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: month ? 'short' : undefined
  });
}

// Helper function to calculate duration
function calculateDuration(start: string, end: string | null): string {
  const startDate = new Date(start);
  const endDate = end ? new Date(end) : new Date();

  const months = (endDate.getFullYear() - startDate.getFullYear()) * 12 +
                 (endDate.getMonth() - startDate.getMonth());

  const years = Math.floor(months / 12);
  const remainingMonths = months % 12;

  if (years === 0) return `${remainingMonths} ${remainingMonths === 1 ? 'month' : 'months'}`;
  if (remainingMonths === 0) return `${years} ${years === 1 ? 'year' : 'years'}`;
  return `${years} ${years === 1 ? 'year' : 'years'}, ${remainingMonths} ${remainingMonths === 1 ? 'month' : 'months'}`;
}
---

<BaseLayout
  title="CV"
  description={`${cv.personal.name} - ${cv.personal.title}. ${cv.summary}`}
>
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} is:inline />
  <div class="container-narrow py-16">
    <!-- Header -->
    <header class="mb-16 pb-8 border-b border-ink/10">
      <h1 class="text-4xl md:text-5xl font-light mb-4">{cv.personal.name}</h1>
      <p class="text-xl md:text-2xl text-copper mb-6">{cv.personal.title}</p>

      <div class="flex flex-wrap gap-4 text-graphite">
        {cv.personal.location && (
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            <span>{cv.personal.location}</span>
          </div>
        )}

        <a href={`mailto:${cv.personal.email}`} class="flex items-center gap-2 no-underline hover:text-copper transition-colors">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
          <span>{cv.personal.email}</span>
        </a>

        {cv.personal.linkedin && (
          <a href={cv.personal.linkedin} class="flex items-center gap-2 no-underline hover:text-copper transition-colors" target="_blank" rel="noopener">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
            <span>LinkedIn</span>
          </a>
        )}

        {cv.personal.github && (
          <a href={cv.personal.github} class="flex items-center gap-2 no-underline hover:text-copper transition-colors" target="_blank" rel="noopener">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
            <span>GitHub</span>
          </a>
        )}
      </div>
    </header>

    <!-- Summary -->
    <section class="mb-16">
      <h2 class="text-2xl font-light mb-6 pb-2 border-b border-ink/10">Professional Summary</h2>
      <p class="text-lg text-graphite leading-relaxed">{cv.summary}</p>
    </section>

    <!-- Key Achievements -->
    <section class="mb-16">
      <h2 class="text-2xl font-light mb-6 pb-2 border-b border-ink/10">Key Achievements</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="bg-beige/50 border border-ink/10 rounded-lg p-6">
          <h3 class="text-lg font-medium text-copper mb-2">Performance Engineering</h3>
          <p class="text-graphite">Improved Lighthouse scores from 30s to 90s at Fleek through dependency optimization, lazy loading under-the-fold components, converting heavy animations to lightweight formats, and implementing CDN strategies with proper cache timing</p>
        </div>
        <div class="bg-beige/50 border border-ink/10 rounded-lg p-6">
          <h3 class="text-lg font-medium text-copper mb-2">Team Productivity</h3>
          <p class="text-graphite">Introduced MSW to enable parallel FE/BE development, eliminating blocking dependencies. Removed unnecessary SSR from internal dashboards, reducing complexity and enabling junior developers to contribute confidently without SSR-related issues</p>
        </div>
        <div class="bg-beige/50 border border-ink/10 rounded-lg p-6">
          <h3 class="text-lg font-medium text-copper mb-2">Distributed Team Leadership</h3>
          <p class="text-graphite">Successfully coordinated teams across 6+ time zones at Fleek through async-first communication and flexible scheduling. Hands-on mentoring approach using real work assignments, pair programming, and continuous feedback loops</p>
        </div>
        <div class="bg-beige/50 border border-ink/10 rounded-lg p-6">
          <h3 class="text-lg font-medium text-copper mb-2">AI Integration</h3>
          <p class="text-graphite">Integrated LangChain-powered chatbot with image generation functionality at Fleek, preparing production-ready AI features for decentralized platform. Demonstrated ability to work with emerging technologies in real-world applications</p>
        </div>
      </div>
    </section>

    <!-- Experience -->
    <section class="mb-16">
      <h2 class="text-2xl font-light mb-6 pb-2 border-b border-ink/10">Experience</h2>
      <div class="space-y-12">
        {cv.experience.map((exp) => (
          <article>
            <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-2 mb-3">
              <div>
                <h3 class="text-xl font-medium">{exp.title}</h3>
                <p class="text-copper">{exp.company} · {exp.location}</p>
              </div>
              <div class="text-graphite text-sm whitespace-nowrap">
                <p>{formatDate(exp.startDate)} - {formatDate(exp.endDate)}</p>
                <p class="text-xs">{calculateDuration(exp.startDate, exp.endDate)}</p>
              </div>
            </div>

            <p class="text-graphite mb-4">{exp.description}</p>

            {exp.achievements.length > 0 && (
              <ul class="list-disc list-inside space-y-2 mb-4 text-graphite">
                {exp.achievements.map((achievement) => (
                  <li>{achievement}</li>
                ))}
              </ul>
            )}

            {exp.skills.length > 0 && (
              <div class="flex flex-wrap gap-2">
                {exp.skills.map((skill) => (
                  <span class="px-3 py-1 bg-ink/5 text-sm text-graphite rounded-full">
                    {skill}
                  </span>
                ))}
              </div>
            )}
          </article>
        ))}
      </div>
    </section>

    <!-- Skills -->
    <section class="mb-16">
      <h2 class="text-2xl font-light mb-6 pb-2 border-b border-ink/10">Skills</h2>
      <div class="space-y-6">
        {cv.skills.technical.map((category) => (
          <div>
            <h3 class="text-lg font-medium mb-3 text-copper">{category.category}</h3>
            <div class="flex flex-wrap gap-2">
              {category.skills.map((skill) => (
                <span class="px-3 py-1 bg-ink/5 text-sm text-graphite rounded-full">
                  {skill}
                </span>
              ))}
            </div>
          </div>
        ))}

        {cv.skills.soft && cv.skills.soft.length > 0 && (
          <div>
            <h3 class="text-lg font-medium mb-3 text-copper">Soft Skills</h3>
            <div class="flex flex-wrap gap-2">
              {cv.skills.soft.map((skill) => (
                <span class="px-3 py-1 bg-ink/5 text-sm text-graphite rounded-full">
                  {skill}
                </span>
              ))}
            </div>
          </div>
        )}
      </div>
    </section>

    <!-- Education -->
    <section class="mb-16">
      <h2 class="text-2xl font-light mb-6 pb-2 border-b border-ink/10">Education</h2>
      <div class="space-y-8">
        {cv.education.map((edu) => (
          <article>
            <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-2 mb-3">
              <div>
                <h3 class="text-xl font-medium">{edu.degree}</h3>
                <p class="text-copper">{edu.institution} · {edu.location}</p>
              </div>
              <div class="text-graphite text-sm">
                <p>{formatDate(edu.startDate)} - {formatDate(edu.endDate)}</p>
              </div>
            </div>

            {edu.description && (
              <p class="text-graphite mb-4">{edu.description}</p>
            )}

            {edu.achievements && edu.achievements.length > 0 && (
              <ul class="list-disc list-inside space-y-2 text-graphite">
                {edu.achievements.map((achievement) => (
                  <li>{achievement}</li>
                ))}
              </ul>
            )}
          </article>
        ))}
      </div>
    </section>

    <!-- Certifications (optional) -->
    {cv.certifications && cv.certifications.length > 0 && (
      <section class="mb-16">
        <h2 class="text-2xl font-light mb-6 pb-2 border-b border-ink/10">Certifications</h2>
        <div class="space-y-6">
          {cv.certifications.map((cert) => (
            <article>
              <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-2 mb-2">
                <div>
                  <h3 class="text-xl font-medium">{cert.name}</h3>
                  <p class="text-copper">{cert.issuer}</p>
                </div>
                <div class="text-graphite text-sm">
                  <p>{formatDate(cert.date)}</p>
                </div>
              </div>

              {cert.credentialId && (
                <p class="text-sm text-graphite mb-2">Credential ID: {cert.credentialId}</p>
              )}

              {cert.url && (
                <a href={cert.url} class="text-copper hover:text-ink transition-colors text-sm" target="_blank" rel="noopener">
                  View Credential →
                </a>
              )}
            </article>
          ))}
        </div>
      </section>
    )}

    <!-- Projects (optional) -->
    {cv.projects && cv.projects.length > 0 && (
      <section class="mb-16">
        <h2 class="text-2xl font-light mb-6 pb-2 border-b border-ink/10">Projects</h2>
        <div class="space-y-8">
          {cv.projects.map((project) => (
            <article>
              <div class="flex items-start justify-between gap-4 mb-3">
                <h3 class="text-xl font-medium">{project.name}</h3>
                <div class="flex gap-2">
                  {project.url && (
                    <a href={project.url} class="text-copper hover:text-ink transition-colors no-underline text-sm" target="_blank" rel="noopener">
                      Live →
                    </a>
                  )}
                  {project.github && (
                    <a href={project.github} class="text-copper hover:text-ink transition-colors no-underline text-sm" target="_blank" rel="noopener">
                      Code →
                    </a>
                  )}
                </div>
              </div>

              <p class="text-graphite mb-4">{project.description}</p>

              {project.highlights.length > 0 && (
                <ul class="list-disc list-inside space-y-2 mb-4 text-graphite">
                  {project.highlights.map((highlight) => (
                    <li>{highlight}</li>
                  ))}
                </ul>
              )}

              <div class="flex flex-wrap gap-2">
                {project.technologies.map((tech) => (
                  <span class="px-3 py-1 bg-ink/5 text-sm text-graphite rounded-full">
                    {tech}
                  </span>
                ))}
              </div>
            </article>
          ))}
        </div>
      </section>
    )}

    <!-- Languages (optional) -->
    {cv.languages && cv.languages.length > 0 && (
      <section class="mb-16">
        <h2 class="text-2xl font-light mb-6 pb-2 border-b border-ink/10">Languages</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
          {cv.languages.map((lang) => (
            <div>
              <p class="font-medium">{lang.name}</p>
              <p class="text-sm text-graphite">{lang.proficiency}</p>
            </div>
          ))}
        </div>
      </section>
    )}

    <!-- Download/Print Button -->
    <div class="flex justify-center pt-8 border-t border-ink/10">
      <button
        onclick="window.print()"
        class="px-6 py-3 bg-ink text-beige rounded-lg hover:bg-ink/90 transition-colors font-medium"
      >
        Download PDF
      </button>
    </div>
  </div>
</BaseLayout>

<style>
  @media print {
    /* Hide ALL navigation, footer, and buttons */
    body > header,
    body > footer,
    header nav,
    footer,
    button,
    nav {
      display: none !important;
      visibility: hidden !important;
      height: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    /* Hide Key Achievements section in print (2nd section after Summary) */
    .container-narrow > section:nth-of-type(2) {
      display: none !important;
    }

    /* Hide older experience entries (keep only recent 6 positions) */
    /* Experience is 3rd section */
    .container-narrow > section:nth-of-type(3) article:nth-of-type(n+7) {
      display: none !important;
    }

    /* Reset page margins - extremely tight to fit 3 pages */
    @page {
      margin: 0.3in 0.4in;
      size: letter;
    }

    * {
      print-color-adjust: exact;
      -webkit-print-color-adjust: exact;
    }

    body {
      font-size: 7.5pt;
      line-height: 1.15;
      margin: 0;
      padding: 0;
    }

    main {
      margin: 0 !important;
      padding: 0 !important;
    }

    .container-narrow {
      max-width: 100%;
      padding: 0 !important;
      margin: 0 !important;
    }

    /* Condense CV header (not site header) */
    .container-narrow > header {
      display: block !important;
      visibility: visible !important;
      height: auto !important;
      margin-bottom: 0.2rem !important;
      padding-bottom: 0.15rem !important;
      border-bottom: 1px solid #00000020;
    }

    h1 {
      font-size: 16pt !important;
      margin-bottom: 0.1rem !important;
      line-height: 1.1 !important;
    }

    h2 {
      font-size: 10pt !important;
      margin-bottom: 0.2rem !important;
      padding-bottom: 0.1rem !important;
      margin-top: 0.25rem !important;
      page-break-after: avoid;
    }

    h3 {
      font-size: 8.5pt !important;
      margin-bottom: 0.1rem !important;
      page-break-after: avoid;
    }

    p {
      margin-bottom: 0.1rem !important;
      font-size: 7.5pt !important;
    }

    /* Condense sections */
    section {
      margin-bottom: 0.25rem !important;
      page-break-inside: auto;
    }

    /* Allow Experience section (3rd section) to break across pages */
    .container-narrow > section:nth-of-type(3) {
      page-break-inside: auto !important;
    }

    /* Condense experience entries - allow page breaks between them */
    article {
      margin-bottom: 0.2rem !important;
      page-break-inside: avoid;
      orphans: 2;
      widows: 2;
    }

    /* Reduce list spacing */
    ul {
      margin-bottom: 0.1rem !important;
      margin-top: 0.1rem !important;
      padding-left: 1rem !important;
    }

    li {
      margin-bottom: 0.05rem !important;
      line-height: 1.1;
      font-size: 7.5pt !important;
    }

    /* Completely redesign Skills section for print - ultra compact */
    /* Skills is the 4th section (Summary, Key Achievements-hidden, Experience, Skills) */
    .container-narrow > section:nth-of-type(4) > div {
      column-count: 2 !important;
      column-gap: 0.4rem !important;
    }

    .container-narrow > section:nth-of-type(4) > div > div {
      break-inside: avoid;
      margin-bottom: 0.25rem !important;
    }

    .container-narrow > section:nth-of-type(4) h3 {
      font-size: 8pt !important;
      margin-bottom: 0.1rem !important;
      font-weight: 600 !important;
    }

    .container-narrow > section:nth-of-type(4) .flex.flex-wrap {
      display: block !important;
    }

    .container-narrow > section:nth-of-type(4) span.px-3.py-1 {
      display: inline !important;
      padding: 0 !important;
      margin: 0 !important;
      background: transparent !important;
      border-radius: 0 !important;
      font-size: 7pt !important;
      line-height: 1.3 !important;
    }

    .container-narrow > section:nth-of-type(4) span.px-3.py-1:not(:last-child)::after {
      content: ", ";
    }

    /* Condense key achievements grid */
    .grid.md\:grid-cols-2 {
      grid-template-columns: repeat(2, 1fr) !important;
      gap: 0.3rem !important;
    }

    .bg-beige\/50 {
      padding: 0.3rem !important;
    }

    /* Reduce spacing in contact info */
    .flex.flex-wrap.gap-4 {
      gap: 0.2rem !important;
      font-size: 7pt !important;
      margin-bottom: 0.15rem !important;
    }

    /* Utility spacing overrides */
    .py-16 {
      padding-top: 0 !important;
      padding-bottom: 0 !important;
    }

    .mb-16 {
      margin-bottom: 0.45rem !important;
    }

    .mb-12 {
      margin-bottom: 0.4rem !important;
    }

    .mb-8 {
      margin-bottom: 0.3rem !important;
    }

    .mb-6 {
      margin-bottom: 0.25rem !important;
    }

    .mb-4 {
      margin-bottom: 0.15rem !important;
    }

    .pb-8 {
      padding-bottom: 0.25rem !important;
    }

    .space-y-12 > * + * {
      margin-top: 0.3rem !important;
    }

    .space-y-8 > * + * {
      margin-top: 0.25rem !important;
    }

    .space-y-6 > * + * {
      margin-top: 0.25rem !important;
    }

    .space-y-4 > * + * {
      margin-top: 0.2rem !important;
    }

    /* Ensure text doesn't orphan */
    p, li, h2, h3 {
      orphans: 2;
      widows: 2;
    }

    /* Make icons smaller */
    svg {
      width: 0.65rem !important;
      height: 0.65rem !important;
    }

    /* Tighter date/duration display */
    .text-sm {
      font-size: 7.5pt !important;
    }

    .text-xl, .text-2xl {
      font-size: 9.5pt !important;
    }
  }
</style>
